{% extends 'developer/client_details/base.html' %}

{% set client_details_page = "oauth_setting" %}

{% block client_details_content %}
  <form method="post">
    {{ form.csrf_token }}
    <h3>OAuth2 Settings</h3>

    <div class="form-group">
      <label class="form-label">OAuth2 Client ID</label>

      <div class="input-group mt-2">
        <input disabled type="text" value="{{ client.oauth_client_id }}" class="form-control">
        <span class="input-group-append">
          <button
              data-clipboard-text="{{ client.oauth_client_id }}"
              class="clipboard btn btn-primary" type="button">
            <i class="fe fe-clipboard"></i>
          </button>
        </span>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">OAuth2 Client Secret</label>

      <div class="input-group mt-2">
        <input disabled type="password" value="{{ client.oauth_client_secret }}" class="form-control">
        <span class="input-group-append">
          <button
              data-clipboard-text="{{ client.oauth_client_secret }}"
              class="clipboard btn btn-primary" type="button">
            <i class="fe fe-clipboard"></i>
          </button>
        </span>
      </div>
    </div>

    <hr>
    <div class="form-group">
      <div class="row">
        <label class="form-label col">Authorized URIs</label>
        <p class="col text-right">
          <small class="text-muted">
            <em>redirect_uri</em> must be <b>https</b> for security reason.
          </small>
        </p>
      </div>

      {% if not client.redirect_uris %}
        <p><small class="text-muted">
          You haven't added any <a href="https://www.oauth.com/oauth2-servers/redirect-uris/">redirect_uri</a>,
          that is the url that will receive the <em>code</em> or <em>access-token</em> in OAuth2 flow.
          <br>
          There's NO NEED to add <em>http://localhost:*</em> here as by default,
          SimpleLogin <em>whitelists</em> localhost!
          <br>
          You DO need to add your <em>redirect_uri</em> here once your website/app goes live.
          <br>
          The <em>redirect_uri</em> need to be HTTPS for security reason.
          <br>
          Start by adding your first <em>redirect_uri</em> here ðŸ‘‡
        </small></p>
      {% endif %}

      {% for redirect_uri in client.redirect_uris %}
        <div class="input-group mt-2">
          <input type="url" name="uri" class="form-control" value="{{ redirect_uri.uri }}"
                 required pattern="^https:\/\/.*"
                 title="redirect_uri must be https">

          <span class="input-group-append">
            <button class="remove-uri btn btn-primary" type="button">
              <i class="fe fe-x"></i>
            </button>
          </span>

        </div>
      {% endfor %}

      <div id="new-uris">
        <!-- New uri will be put here -->
      </div>


      <button type="button" id="create-new-uri" class="mt-2 btn btn-secondary">Add new uri</button>
    </div>

    <button type="submit" class="btn btn-primary btn-lg">Update</button>
  </form>

  <!-- template for new uri -->
  <div class="input-group mt-2" id="hidden-uri" style="display: none">
    <input type="url" name="uri" class="form-control"
           required pattern="^https:\/\/.*"
           title="redirect_uri must be https">

    <span class="input-group-append">
      <button class="remove-uri btn btn-primary" type="button">
        <i class="fe fe-x"></i>
      </button>
    </span>

  </div>
{% endblock %}

{% block script %}
  <script>
    $("#create-new-uri").on("click", function (e) {
      var clone = $("#hidden-uri").clone(true, true); // (true, true) to clone withDataAndEvents, deepWithDataAndEvents
      clone.removeAttr("id");

      $("#new-uris").append(clone);
      clone.show();
    });

    $(".remove-uri").click(function (e) {
      var currentElement = $(this);
      currentElement.parent().parent().remove();
    });

  </script>
{% endblock %}